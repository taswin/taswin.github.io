<!DOCTYPE html>
<html>
<body onresize="resize()">
  <canvas id="canvas" width=820px height=430px></canvas>
  <canvas id="canvas_b" width=10000px height=10000px></canvas>
</body>

<div id="objects"><span>
 <button onclick="draw(false)">Draw</button> <button onclick="draw(true)">Animate</button>
 <br>
 Light speed: <input type="text" name="lightm" maxLength=5  onkeypress="return (event.charCode >= 48 && event.charCode <= 57) || event.charCode == 45" value="1">m / <input type="text" name="lights" maxLength=5  onkeypress="return (event.charCode >= 48 && event.charCode <= 57) || event.charCode == 45" value="1">s
 <br>
 <h><input type="checkbox" onclick="showHide(this, 'div')" checked><h1 name="obj">1</h1>
 <div name="object" class="obj"><span>
  <h>Emits light:
  <input type="checkbox" name="emitsLight" onclick="if(this.checked){this.parentNode.getElementsByTagName('div')[0].getElementsByTagName('input')[0].style.display='block';}else{this.parentNode.getElementsByTagName('div')[0].getElementsByTagName('input')[0].style.display='none';}" checked>
  <div name="observer">
   Observer: <input type="number" name="obs" min=0 value=0></input>
  </div></h>
  Start:
  <br>
  X: <input type="text" name="startX" maxLength=5  onkeypress="return (event.charCode >= 48 && event.charCode <= 57) || event.charCode == 45" value="0">
  Y: <input type="text" name="startY" maxLength=5  onkeypress="return (event.charCode >= 48 && event.charCode <= 57) || event.charCode == 45" value="0">
  <br>
  <h><input type="checkbox" onclick="showHide(this, 'div')" checked><h2 name="stg">a</h2>
  <div name="stage"  class="stg">
   Velocity: <input type="text" name="velm" maxLength=5  onkeypress="return (event.charCode >= 48 && event.charCode <= 57) || event.charCode == 45" value="1">m / <input type="text" name="vels" maxLength=5  onkeypress="return (event.charCode >= 48 && event.charCode <= 57) || event.charCode == 45" value="2">s
   <br>
   Colour: <input type="text" name="colour" maxlength=6  onkeypress="return (event.charCode >= 48 && event.charCode <= 57) || (event.charCode >= 65 && event.charCode <= 70) || (event.charCode >= 97 && event.charCode <= 102)" value="000000"> RGB (Hex)
   <br>
   Time of velocity change: <input type="text" name="velChange" maxLength=5  onkeypress="(return event.charCode >= 48 && event.charCode <= 57) || event.charCode == 45" value="200">s
  </div></h>
  </span><button onclick="addStage(this)" id="addStage">Add stage</button>
 </div></h>
 </span><button onclick="addObject(this);" id="addObject">Add object</button>
</div>

<style>
canvas 
{
  position: absolute;
  top: 10px;
  left: 10px;
  display: block;
  border: #666 1px solid;
}
#canvas_b
{
  display: none;
}
html, body 
{
  width:  100%;
  height: 100%;
  margin: 0px;
  overflow: hidden;
}
div
{
  padding-left: 10px;
  border-left: #FF0000 1px solid;
}
h1,h2
{
  display: inline-block;
  font-size: 1em;
  margin: 0;
  font-weight: normal;
}
#objects 
{
  width: 250px;
  height: 400px;
  overflow: auto;
  position: absolute;
  top: 10px;
  right: 10px;
  padding: 10px;
  display: none;
  display: block;
  border: #666 1px solid;
}
input[name=lightm],input[name=lights],input[name=startX],input[name=startY],input[name=velm],input[name=vels],input[name=velChange]
{
  width: 35px;
}
input[name=obs]
{
  width: 50px;
}
input[name=colour]
{
  width: 50px;
}
</style>

<script>
var ctx, ctx_b, canvas, canvas_b;
var width;
var height;
var max = 
{
  x: 0,
  y: 0
};
var min = 
{
  x: 0,
  y: 0
};
t = {
 obj: [1],
 stg: [1],
}
var stageStr = "<h><input type=\"checkbox\" onclick=\"showHide(this, 'div')\" checked><h2 name=\"stg\">{stg}<\/h2><div name=\"stage\"  class=\"stg\">Velocity: <input type=\"text\" name=\"velm\" maxLength=5  onkeypress=\"return (event.charCode >= 48 && event.charCode <= 57) || event.charCode == 45\" value=\"1\">m \/ <input type=\"text\" name=\"vels\" maxLength=5  onkeypress=\"return (event.charCode >= 48 && event.charCode <= 57) || event.charCode == 45\" value=\"2\">s\<br>Colour: <input type=\"text\" name=\"colour\" maxlength=6  onkeypress=\"return (event.charCode >= 48 && event.charCode <= 57) || (event.charCode >= 65 && event.charCode <= 70) || (event.charCode >= 97 && event.charCode <= 102)\" value=\"000000\"> RGB (Hex)<br>Time of velocity change: <input type=\"text\" name=\"velChange\" maxLength=5  onkeypress=\"(return event.charCode >= 48 && event.charCode <= 57) || event.charCode == 45\" value=\"200\">s<br>{rem}<\/div><\/h>";
var objectStr = "<h><input type=\"checkbox\" onclick=\"showHide(this, 'div')\" checked><h1 name=\"obj\">{obj}<\/h1><div name=\"object\" class=\"obj\"><span><h>Emits light:<input type=\"checkbox\" name=\"emitsLight\" onclick=\"if(this.checked){this.parentNode.getElementsByTagName('div')[0].getElementsByTagName('input')[0].style.display='block';}else{this.parentNode.getElementsByTagName('div')[0].getElementsByTagName('input')[0].style.display='none';}\" checked><div name=\"observer\">Observer: <input type=\"number\" name=\"obs\" min=0 value=0><\/input><\/div><\/h>Start:<br>X: <input type=\"text\" name=\"startX\" maxLength=5  onkeypress=\"return (event.charCode >= 48 && event.charCode <= 57) || event.charCode == 45\" value=\"0\">Y: <input type=\"text\" name=\"startY\" maxLength=5  onkeypress=\"return (event.charCode >= 48 && event.charCode <= 57) || event.charCode == 45\" value=\"0\"><br>"+stageStr+"<\/span><button onclick=\"addStage(this)\" id=\"addStage\">Add stage<\/button><br><button onclick=\"removeParent(this)\">Remove object<\/button><\/div><\/h>";

resize();
function resize()
{
  canvas = document.getElementById('canvas');
  ctx = canvas.getContext('2d');
  
  canvas_b = document.getElementById('canvas_b');
  ctx_b = canvas_b.getContext('2d');
  
  canvas.width  = window.innerWidth - 300;
  canvas.height = window.innerHeight -20;
  
  width = canvas.width;
  height = canvas.height;
  
  max.x = width / 2;
  min.x = max.x - width;
  max.y = height - 20;
  min.y = max.y - height;
  
  ctx.drawImage(canvas_b, 0, 0, canvas_b.width, canvas_b.height, 0, 0, width, height);
}

function draw(animated)
{
  canvas = document.getElementById('canvas');
  ctx = canvas.getContext('2d');
  
  canvas_b = document.getElementById('canvas_b');
  ctx_b = canvas_b.getContext('2d');
  
  width = canvas.width;
  height = canvas.height;
  
  max.x = width / 2;
  min.x = max.x - width;
  max.y = height - 20;
  min.y = max.y - height;
  
  //ctx.setTransform(1, 0, 0, -1, -min.x, max.y);
  ctx.clearRect(min.x, min.y, max.x - min.x, max.y - min.y);
  
  ctx_b.setTransform(1, 0, 0, -1, canvas_b.width/2, canvas_b.height - 20);
  ctx_b.clearRect(-canvas_b.width/2, canvas_b.height - 20, canvas_b.width, canvas_b.height);
  
  ctx_b.beginPath();
  ctx_b.fillStyle = "#00FFFF";
  ctx_b.fillRect(-canvas_b.width/2+10, -10, canvas_b.width-20, canvas_b.height-20);
  ctx_b.closePath();
  
  ctx_b.beginPath();
  ctx_b.fillStyle = "#00FF0F";
  ctx_b.fillRect(-50, -10, 100, 100);
  ctx_b.closePath();
  
  ctx.drawImage(canvas_b, 0, 0, canvas_b.width, canvas_b.height, 0, 0, width, height);
}

function addObject(e) 
{
  var objects = e.parentNode.getElementsByTagName("span")[0];
  t.obj[0] += 1;
  t.stg[t.obj[0]-1] = 1;
  objects.innerHTML += format(objectStr, t.obj[0]-1).replace(/{rem}/g, "");
}

function addStage(e) 
{
  var num = e.parentNode.parentNode.getElementsByTagName("h1");num = num[num.length-1].innerHTML-1;
  t.stg[num] += 1;
  var object = e.parentNode.getElementsByTagName("span")[0];
  object.innerHTML += format(stageStr, num).replace(/{rem}/g, "<button onclick=\"removeParent(this)\">Remove stage<\/button>");
}

function removeParent(e)
{
  var num = e.parentNode.parentNode.parentNode.parentNode.parentNode.getElementsByTagName("h1");num = num[num.length-1].innerHTML-1;
  var type = e.parentNode.className;
  var pars = e.parentNode.parentNode.parentNode;
  e.parentNode.parentNode.remove();
  
  if (type == "stg")
  {
    t.stg[num] -= 1;
    var stgs = pars.getElementsByTagName("h2");
    for (var i = 0; i < stgs.length; i++)
    {
      stgs[i].innerHTML = 'abcdefghijklmnopqrstuvwxyz'[i];
    }
  }
  else if (type == "obj")
  {
    t.obj[0] -= 1;
    var objs = pars.getElementsByTagName("h1");
    for (var i = 0; i < objs.length; i++)
    {
      objs[i].innerHTML = i+1;
    }
  }
}

function format(str, stgNum)
{
  return str.replace(/{obj}/g, t.obj[0]).replace(/{stg}/g, 'abcdefghijklmnopqrstuvwxyz'[t.stg[stgNum]-1]);
}

function showHide(e, sh)
{
  if(e.checked)
  {
    e.parentNode.getElementsByTagName(sh)[0].style.display='block';
  }
  else
  {
    e.parentNode.getElementsByTagName(sh)[0].style.display='none';
  }
}
</script>
</html>
