<!DOCTYPE html>
<html>
<div name="objects" id="objects">
<pre>
Light speed: <input type="text" name="lightm" maxLength=5 size=1 onkeypress="(return event.charCode >= 48 && event.charCode <= 57) || event.charCode == 45" value="-1">m / <input type="text" name="lights" maxLength=5 size=1 onkeypress="(return event.charCode >= 48 && event.charCode <= 57) || event.charCode == 45" value="1">s
</pre>
  <div name="object">
    <pre>
Object <h name="num">1:</h>
  Emits light: <input type="checkbox" name="emitsLight" checked>
  Start:
    X: <input type="text" name="startX" maxLength=5 size=1 onkeypress="(return event.charCode >= 48 && event.charCode <= 57) || event.charCode == 45" value="0">
    Y: <input type="text" name="startY" maxLength=5 size=1 onkeypress="(return event.charCode >= 48 && event.charCode <= 57) || event.charCode == 45" value="0">
  Velocity:
    1: <input type="text" name="vel1m" maxLength=5 size=1 onkeypress="(return event.charCode >= 48 && event.charCode <= 57) || event.charCode == 45" value="1">m / <input type="text" name="vel1s" maxLength=5 size=1 onkeypress="(return event.charCode >= 48 && event.charCode <= 57) || event.charCode == 45" value="2">s
    2: <input type="text" name="vel2m" maxLength=5 size=1 onkeypress="(return event.charCode >= 48 && event.charCode <= 57) || event.charCode == 45" value="-1">m / <input type="text" name="vel2s" maxLength=5 size=1 onkeypress="(return event.charCode >= 48 && event.charCode <= 57) || event.charCode == 45" value="2">s
  Time of velocity change: <input type="text" name="velChange" maxLength=5 size=1 onkeypress="(return event.charCode >= 48 && event.charCode <= 57) || event.charCode == 45" value="100">ms
</pre>
  </div>
<button onclick="addObject()" name="addObject">Add object</button>
</div>

<body>
  <button onclick="draw(false)">Draw</button>
  <button onclick="draw(true)">Animate</button>
  <br>
  <canvas id="canvas" width="800" height="420"></canvas>
</body>
</body>

<style>
canvas {
  border: #666 1px solid;
}

#objects {
  width: 250px;
  height: 400px;
  align: right;
  overflow: auto;

  position: absolute;
  right: 0px;
  padding: 10px;
  border: #666 1px solid;
}
Try it Yourself Â»

</style>

<script>
var canvas;
var ctx;
var width;
var height;
var velLight;
var max = {
  x: 0,
  y: 0
};
var min = {
  x: 0,
  y: 0
};
var border = 10;
var timeouts = [];
var objectNum = 0;

function draw(animated) {
  canvas = document.getElementById('canvas');
  ctx = canvas.getContext('2d');
  width = canvas.width;
  height = canvas.height;
  max.x = width / 2;
  min.x = max.x - width;
  max.y = height - 20; // / 2;
  min.y = max.y - height;

  for (var i = 0; i < timeouts.length; i++) {
    clearTimeout(timeouts[i]);
  }

  ctx.setTransform(1, 0, 0, -1, -min.x, max.y);
  ctx.clearRect(min.x, min.y, max.x - min.x, max.y - min.y);

  velLight = document.getElementsByName('lights')[0].value / document.getElementsByName('lightm')[0].value;

  drawLineP(min.x + border, 0, max.x - border, 0, "#0000FF");
  drawLineP(0, min.y + border, 0, max.y - border, "#0000FF");

  drawLineG(false, [0, 0], 0, velLight, 0, "#00FF00");
  drawLineG(false, [0, 0], 0, -velLight, 0, "#00FF00");

  for (var i = 0; i < document.getElementsByName('object').length; i++) {
    var emitsLight = document.getElementsByName('emitsLight')[i].checked;

    var x = document.getElementsByName('startX')[i].value;
    var y = document.getElementsByName('startY')[i].value;
    var start = [x, y];

    var vel = [document.getElementsByName('vel1s')[i].value / document.getElementsByName('vel1m')[i].value, document.getElementsByName('vel2s')[i].value / document.getElementsByName('vel2m')[i].value];

    var velChange = document.getElementsByName('velChange')[i].value;

    switch (animated)
	{
	  case true:
	    animateLineG(emitsLight, start, parseInt(y), vel, velChange, "#000000");
		break;
	  case false:
	    drawLineG(emitsLight, start, parseInt(y), vel, velChange, "#000000");
		break;
	}
  }
}

function animateLineG(emitsLight, start, y, vel, velChange, colour) {
  var x = start[0] - (start[1] / vel[0]) + (y / vel[0]);
  drawPoint(x, y, colour);

  if (y % 20 == 0 && emitsLight) {
    if ((x > 0 && velLight < 0) || (x <= 0 && velLight >= 0)) {
      animateLineG(false, [x, y], y, [velLight, velLight], 0, "#FF0000");
    } else {
      animateLineG(false, [x, y], y, [-velLight, -velLight], 0, "#FF0000");
    }
  }

  y += 1;
  if (velChange > 0) {
    velChange -= 1;
  } else if (velChange == 0) {
    start = [x, y];
    vel = [vel[1], vel[0]];
    velChange = -1;
  }

  if (x < max.x - border && x > min.x + border && y < max.y - border && y > min.y + border && (x > 1 || x < -1 || velChange > -1)) {
    timeouts.push(setTimeout(function() {
      animateLineG(emitsLight, start, y, vel, velChange, colour);
    }, 30));
  }
}

function drawLineG(emitsLight, start, y, vel, velChange, colour) {
  var x = 0;
  while (x < max.x - border && x > min.x + border && y < max.y - border && y > min.y + border && (x > 1 || x < -1 || velChange > -1)) {
    var x = start[0] - (start[1] / vel[0]) + (y / vel[0]);
    drawPoint(x, y, colour);

    if (y % 20 == 0 && emitsLight) {
      if ((x > 0 && velLight < 0) || (x <= 0 && velLight >= 0)) {
        drawLineG(false, [x, y], y, [velLight, velLight], 0, "#FF0000");
      } else {
        drawLineG(false, [x, y], y, [-velLight, -velLight], 0, "#FF0000");
      }
    }

    y += 1;
    if (velChange > 0) {
      velChange -= 1;
    } else if (velChange == 0) {
      start = [x, y];
      vel = [vel[1], vel[0]];
      velChange = -1;
    }
  }
}

function drawLineP(x1, y1, x2, y2, colour) {
  ctx.beginPath();
  ctx.strokeStyle = colour;
  ctx.moveTo(x1, y1);
  ctx.lineTo(x2, y2);
  ctx.stroke();
  ctx.closePath();
}

function drawPoint(x, y, colour) {
  ctx.beginPath();
  ctx.fillStyle = colour;
  ctx.fillRect(x - 1, y - 1, 2, 2);
  ctx.closePath();
}

function addObject() {
  var objects = document.getElementsByName("objects")[0];
  var object = document.getElementsByName("object")[0];
  var newObject = object.cloneNode(true);

  var remove = document.createElement("input");
  remove.setAttribute("type", "button");
  remove.setAttribute("value", "Remove object");
  remove.setAttribute("onClick", "removeObject(this)");

  newObject.appendChild(remove);
  objects.appendChild(newObject);
  objects.insertBefore(newObject, document.getElementsByName("addObject")[0]);
  
  objectNum += 1;
  document.getElementsByName("num")[objectNum].innerHTML = "" + (objectNum + 1);
}

function removeObject(e) {
  e.parentNode.remove();
  
  objectNum -= 1;
}
</script>
</html>
